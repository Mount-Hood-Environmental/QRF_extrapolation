---
title: "Documentation for modified -new- QRF model"
author:
- Bryce N. Oldemeyer:
    email: Bryce.Oldemeyer@mounthoodenvironmental.com
    institute: mhe_challis
    correspondence: yes
- Mark Roes:
    email: mark.roes@mthoodenvironmental.com
    institute: mhe_sandy
    correspondence: no
- Michael W. Ackerman:
    email: mike.ackerman@mthoodenvironmental.com
    institute: mhe_mccall
    correspondence: no
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    toc: yes
    toc_depth: '2'
    df_print: paged
  bookdown::html_document2:
    theme: yeti
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: yes
      smooth_scroll: yes
    number_sections: yes
    pandoc_args:
    - --lua-filter=../templates/scholarly-metadata-updated.lua
    - --lua-filter=../templates/author-info-blocks-updated.lua
    - --lua-filter=../templates/pagebreak-updated.lua
institute:
- mhe_challis: Mount Hood Environmental, PO Box 1303, Challis, Idaho, 83226, USA
- mhe_mccall: Mount Hood Environmental, PO Box 4282, McCall, Idaho, 83638, USA
- mhe_sandy: Mount Hood Environmental, 39085 Pioneer Boulevard \#100 Mezzanine, Sandy,
    Oregon, 97055, USA
csl: ../templates/american-fisheries-society.csl
---

<!-- the following inserts MHE logo into header -->
<script>
   $(document).ready(function() {
     $head = $('#header');
     $head.prepend('<img src=\"logo.jpg\" style=\"float: right;width: 150px;\"/>')
   });
</script>

```{r setup, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  comment = "#>",
  fig.path = "../figures/",
  dpi = 600
)

options(knitr.kable.NA = '--')

```

```{r load-libraries}
# run this if running chunks directly

# for formatting
library(kableExtra)
library(ggpubr)

# for analysis
library(sf)
library(here)
library(tidyverse)
library(magrittr)
library(ggmap)
library(nngeo)
library(janitor)
library(data.table)

theme_set(theme_pubr(x.text.angle = 45,
                     base_size = 8))

```

```{r load-data}
in_path = 'S:/main/data/qrf/gitrepo_data/input/'
out_path = 'S:/main/data/qrf/gitrepo_data/output/'

# load .rda created from the "extrap_comparison_data_prep.R" script
load(paste0(out_path,'gpkg/extrap_compare/US_qrf_extraps_comp.rda'))

# Project area polygons and 200m layer (with habitat attributes) within project area
load(paste0(out_path,'gpkg/extrap_compare/US_spatial.rda'))

# convert old sf objects to tibbles
US_sum_df_old_extrap = US_sum_sf_old_extrap %>%
  st_drop_geometry() %>%
  as_tibble()

US_win_df_old_extrap = US_win_sf_old_extrap %>%
  st_drop_geometry() %>%
  as_tibble()

US_redds_df_old_extrap = US_redds_sf_old_extrap %>%
  st_drop_geometry() %>%
  as_tibble()

# convert new sf objects to tibbles
US_sum_df_new_extrap = US_sum_sf_new_extrap %>%
  st_drop_geometry() %>%
  as_tibble()

US_win_df_new_extrap = US_win_sf_new_extrap %>%
  st_drop_geometry() %>%
  as_tibble()

US_redds_df_new_extrap = US_redds_sf_new_extrap %>%
  st_drop_geometry() %>%
  as_tibble()

# the spatial domain for the species and life stages of the old extrapolations were modified from Morgon Bond's 
# designation to include local knowledge from biologists. To keep things consistent, we will use the same spatial domain
# for the new extrapolations. 

# redds
US_redds_sf_new_extrap = US_redds_sf_new_extrap %>%
  select(-chnk, -sthd) %>%
  st_join(US_redds_sf_old_extrap %>%
            select(chnk, sthd),
          join = st_covered_by,
          left = F)

# summer juv
US_sum_sf_new_extrap = US_sum_sf_new_extrap %>%
  select(-chnk, -sthd) %>%
  st_join(US_sum_sf_old_extrap %>%
            select(chnk, sthd),
          join = st_covered_by,
          left = F)

# winter juv
US_win_sf_new_extrap = US_win_sf_new_extrap %>%
  select(-chnk, -sthd) %>%
  st_join(US_win_sf_old_extrap %>%
            select(chnk, sthd),
          join = st_covered_by,
          left = F)

# create comparison tibbles for mapping

US_sum_sf_comp_extrap = bind_cols(setorder(US_sum_sf_old_extrap[,-c(21:32)], UniqueID), setorder(US_sum_df_new_extrap, UniqueID)[,c(21:32)] - setorder(US_sum_df_old_extrap, UniqueID)[,c(21:32)])

US_win_sf_comp_extrap = bind_cols(setorder(US_win_sf_old_extrap[,-c(21:32)], UniqueID), setorder(US_win_df_new_extrap, UniqueID)[,c(21:32)] - setorder(US_win_df_old_extrap, UniqueID)[,c(21:32)])

US_redds_sf_comp_extrap = bind_cols(setorder(US_redds_sf_old_extrap[,-c(21:32)], UniqueID), setorder(US_redds_df_new_extrap, UniqueID)[,c(21:32)] - setorder(US_redds_df_old_extrap, UniqueID)[,c(21:32)])


```

# Background

This is the skeleton rmd outlining the development of a revised ("new") QRF model (See et al. 2021). This will eventually highlight the covariate selection process, QRF model fit, the RF extrapolation model, and finally compare extrapolation estimates between the original and new models for eight watersheds within the Upper Salmon Basin. 

## Covariate selection

Explain covariate selection process. DASH/resto compatible, high MIC, low correlation, missing data, lots of zeros, species specific models, and eventually converting to joint models.

## QRF Model fit

Talk about relative importance and pdp plots.

## Extrapolation model

Talk about GAA's

## Extrapolation comparison


<!-- Below is a bunch of script to calculate watershed capacities, make pretty figures, and create simple tables. I took it from the UWW and NF assessment .rmd's so if something isn't running, go back and look at those scripts to help troubleshoot. Additionally, use the "wtrshd" variable to filter the eight watersheds. The "watershed" variable is taken from the WBDHU12.shp and isn't that useful.  -->

```{r capacity-funs}
source(here("R/calc_watershed_cap.R"))

cap_by_ws = function(x, speciescode){
  ws_list = unique(x$wtrshd)
  
  out = filter(
    bind_rows(
    calc_watershed_cap(US_huc_sf,
                       filter(x, wtrshd == ws_list[1]),
                       capacity_name = paste0(speciescode,"_per_m"),
                       capacity_se_name = paste0(speciescode,"_per_m_se"),
                       by_stream = T) %>%
      mutate(Watershed = ws_list[1]),
  
  calc_watershed_cap(US_huc_sf,
                     filter(x, wtrshd == ws_list[2]),
                     capacity_name = paste0(speciescode,"_per_m"),
                     capacity_se_name = paste0(speciescode,"_per_m_se"),
                     by_stream = T) %>%
      mutate(Watershed = ws_list[2]),
  
  calc_watershed_cap(US_huc_sf,
                     filter(x, wtrshd == ws_list[3]),
                     capacity_name = paste0(speciescode,"_per_m"),
                     capacity_se_name = paste0(speciescode,"_per_m_se"),
                     by_stream = T) %>%
      mutate(Watershed = ws_list[3]),
  
  calc_watershed_cap(US_huc_sf,
                     filter(x, wtrshd == ws_list[4]),
                     capacity_name = paste0(speciescode,"_per_m"),
                     capacity_se_name = paste0(speciescode,"_per_m_se"),
                     by_stream = T) %>%
      mutate(Watershed = ws_list[4]),
  
    calc_watershed_cap(US_huc_sf,
                     filter(x, wtrshd == ws_list[5]),
                     capacity_name = paste0(speciescode,"_per_m"),
                     capacity_se_name = paste0(speciescode,"_per_m_se"),
                     by_stream = T) %>%
      mutate(Watershed = ws_list[5]),
  
    calc_watershed_cap(US_huc_sf,
                     filter(x, wtrshd == ws_list[6]),
                     capacity_name = paste0(speciescode,"_per_m"),
                     capacity_se_name = paste0(speciescode,"_per_m_se"),
                     by_stream = T) %>%
      mutate(Watershed = ws_list[6]),
  
    calc_watershed_cap(US_huc_sf,
                     filter(x, wtrshd == ws_list[7]),
                     capacity_name = paste0(speciescode,"_per_m"),
                     capacity_se_name = paste0(speciescode,"_per_m_se"),
                     by_stream = T) %>%
      mutate(Watershed = ws_list[7]),
  
    calc_watershed_cap(US_huc_sf,
                     filter(x, wtrshd == ws_list[8]),
                     capacity_name = paste0(speciescode,"_per_m"),
                     capacity_se_name = paste0(speciescode,"_per_m_se"),
                     by_stream = T) %>%
      mutate(Watershed = ws_list[8])),
    StreamName != "Total"|is.na(StreamName)) %>%
    group_by(Watershed) %>%
    summarise(across(c(n_rchs,tot_length,tot_cap,tot_cap_se),
              sum,
              na.rm = T),
              .groups = "drop")

  return(out)
}

```

```{r calc-chnk-capacity}

# Chinook salmon, summer parr
chnk_sum_cap_new = cap_by_ws(US_sum_sf_new_extrap, "chnk")

# Chinook salmon, winter presmolt
chnk_win_cap_new = cap_by_ws(US_win_sf_new_extrap, "chnk")

# Chinook salmon, redds
chnk_redd_cap_new = cap_by_ws(US_redds_sf_new_extrap, "chnk")

# Old extraps for comparison ####
# Chinook salmon, summer parr
chnk_sum_cap_old = cap_by_ws(US_sum_sf_old_extrap, "chnk")

# Chinook salmon, winter presmolt
chnk_win_cap_old = cap_by_ws(US_win_sf_old_extrap, "chnk")

# Chinook salmon, redds
chnk_redd_cap_old = cap_by_ws(US_redds_sf_old_extrap, "chnk")

```

```{r calc-sthd-capacity}

# steelhead salmon, summer parr
sthd_sum_cap_new = cap_by_ws(US_sum_sf_new_extrap, "sthd")

# steelhead salmon, winter presmolt
sthd_win_cap_new = cap_by_ws(US_win_sf_new_extrap, "sthd")

# steelhead salmon, redds
sthd_redd_cap_new = cap_by_ws(US_redds_sf_new_extrap, "sthd")

# Old extraps for comparison ####
# steelhead salmon, summer parr
sthd_sum_cap_old = cap_by_ws(US_sum_sf_old_extrap, "sthd")

# steelhead salmon, winter presmolt
sthd_win_cap_old = cap_by_ws(US_win_sf_old_extrap, "sthd")

# steelhead salmon, redds
sthd_redd_cap_old = cap_by_ws(US_redds_sf_old_extrap, "sthd")
```

```{r create-chnk-maps}
# pick a background river color
river_color = "lightskyblue1"

#New extrap maps####
# chinook summer parr
chnk_sum_map = US_sum_sf_new_extrap %>%
  ggplot() +
  geom_sf(data = US_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = US_sum_sf_new_extrap %>%
            filter(chnk),
          aes(color = chnk_per_m2),
          size = 1) +
  scale_color_viridis_c(direction = -1) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "Chinook, Summer Juveniles",
       color = expression(`Summer Juv` / m^2))

# chinook winter presmolts
chnk_win_map = US_win_sf_new_extrap %>%
  ggplot() +
  geom_sf(data = US_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = US_win_sf_new_extrap %>%
            filter(chnk),
          aes(color = chnk_per_m2),
          size = 1) +
  scale_color_viridis_c(direction = -1) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "Chinook, Winter Juveniles",
       color = expression(`Winter Juv` / m^2))

# chinook redds
chnk_redd_map = US_redds_sf_new_extrap %>%
  ggplot() +
  geom_sf(data = US_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = US_redds_sf_new_extrap %>%
            filter(chnk) %>%
            mutate(chnk_per_km = chnk_per_m * 1000),
          aes(color = chnk_per_km),
          size = 1) +
  scale_color_viridis_c(direction = -1) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "Chinook, Redds",
       color = expression(Redds / km))

#Comparison maps####
# chinook summer parr
chnk_sum_comp_map = US_sum_sf_comp_extrap %>%
  ggplot() +
  geom_sf(data = US_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = US_sum_sf_comp_extrap %>%
            filter(chnk),
          aes(color = chnk_per_m2),
          size = 1) +
  scale_color_viridis_c(direction = -1) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "Chinook, Summer Juveniles",
       color = expression(`Summer Juv` / m^2))

# chinook winter presmolts
chnk_win_comp_map = US_win_sf_comp_extrap %>%
  ggplot() +
  geom_sf(data = US_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = US_win_sf_comp_extrap %>%
            filter(chnk),
          aes(color = chnk_per_m2),
          size = 1) +
  scale_color_viridis_c(direction = -1) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "Chinook, Winter Juveniles",
       color = expression(`Winter Juv` / m^2))

# chinook redds
chnk_redd_comp_map = US_redds_sf_comp_extrap %>%
  ggplot() +
  geom_sf(data = US_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = US_redds_sf_comp_extrap %>%
            filter(chnk) %>%
            mutate(chnk_per_km = chnk_per_m * 1000),
          aes(color = chnk_per_km),
          size = 1) +
  scale_color_viridis_c(direction = -1) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "Chinook, Redds",
       color = expression(Redds / km))
    

```

```{r create-sthd-maps}
# steelhead summer juveniles
sthd_sum_map = US_sum_sf_new_extrap %>%
  ggplot() +
  geom_sf(data = US_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = US_sum_sf_new_extrap %>%
            filter(sthd),
          aes(color = sthd_per_m2),
          size = 1) +
  scale_color_viridis_c(direction = -1) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "Steelhead, Summer Juveniles",
       color = expression(`Summer Juv` / m^2))

# steelhead winter juveniles
sthd_win_map = US_win_sf_new_extrap %>%
  ggplot() +
  geom_sf(data = US_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = US_win_sf_new_extrap %>%
            filter(sthd),
          aes(color = sthd_per_m2),
          size = 1) +
  scale_color_viridis_c(direction = -1) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "Steelhead, Winter Juveniles",
       color = expression(`Winter Juv` / m^2))

# steelhead redds
sthd_redd_map = US_redds_sf_new_extrap %>%
  ggplot() +
  geom_sf(data = US_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = US_redds_sf_new_extrap %>%
            filter(sthd) %>%
            mutate(sthd_per_km = sthd_per_m * 1000),
          aes(color = sthd_per_km),
          size = 1) +
  scale_color_viridis_c(direction = -1) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "Steelhead, Redds",
       color = expression(Redds / km))

# Comparison maps ####
# steelhead summer juveniles
sthd_sum_comp_map = US_sum_sf_comp_extrap %>%
  ggplot() +
  geom_sf(data = US_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = US_sum_sf_comp_extrap %>%
            filter(sthd),
          aes(color = sthd_per_m2),
          size = 1) +
  scale_color_viridis_c(direction = -1) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "Steelhead, Summer Juveniles",
       color = expression(`Summer Juv` / m^2))

# steelhead winter juveniles
sthd_win_comp_map = US_win_sf_comp_extrap %>%
  ggplot() +
  geom_sf(data = US_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = US_win_sf_comp_extrap %>%
            filter(sthd),
          aes(color = sthd_per_m2),
          size = 1) +
  scale_color_viridis_c(direction = -1) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "Steelhead, Winter Juveniles",
       color = expression(`Winter Juv` / m^2))

# steelhead redds
sthd_redd_comp_map = US_redds_sf_comp_extrap %>%
  ggplot() +
  geom_sf(data = US_huc_sf %>%
            st_union() %>%
            nngeo::st_remove_holes(),
          fill = NA,
          color = "gray50") +
  geom_sf(color = river_color) +
  geom_sf(data = US_redds_sf_comp_extrap %>%
            filter(sthd) %>%
            mutate(sthd_per_km = sthd_per_m * 1000),
          aes(color = sthd_per_km),
          size = 1) +
  scale_color_viridis_c(direction = -1) +
  #theme_bw() +
  theme(legend.position = "bottom",
        axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  labs(title = "Steelhead, Redds",
       color = expression(Redds / km))

```

```{r chnk-maps, fig.cap = "Extrapolations of habitat capacity for Chinook salmon, by life-stage, within the North Fork Salmon watershed."}
ggarrange(chnk_sum_map,
          chnk_win_map,
          chnk_redd_map)

```

```{r sthd-maps, fig.cap = "Extrapolations of habitat capacity for steelhead, by life-stage, within the North Fork Salmon watershed.."}
ggarrange(sthd_sum_map,
          sthd_win_map,
          sthd_redd_map)

```

::: {#refs}
:::


## QRF Habitat Capacity Estimates

### Comparison with previous extrapolation

#### Chinook Salmon


```{r chnk-maps-comp, fig.cap = "Change in predicted habitat capacity for Chinook salmon compared to the previous extrapolation, by life-stage, within the North Fork Salmon watershed."}
ggarrange(chnk_sum_comp_map,
          chnk_win_comp_map,
          chnk_redd_comp_map)

```


```{r chnk-comp-summary-tbls}

capcompare = function(cap_new,cap_old,modelname){
  out = cap_new[,c(1,4,5)] %>%
  left_join(cap_old[,c(1,4,5)], by = "Watershed", suffix = c("_new","_old")) %>%
  mutate(Model = modelname,
         cap_change_percent = (tot_cap_new/tot_cap_old-1) * 100,
         se_change_percent = (tot_cap_se_new/tot_cap_se_old-1) * 100) %>%
    select(Model, 
           Watershed, 
           tot_cap_new, 
           cap_change_percent, 
           tot_cap_se_new, 
           se_change_percent)
  
}

chnk_summary = bind_rows(
  capcompare(chnk_sum_cap_new, chnk_sum_cap_old, "Juv summer"),
  capcompare(chnk_win_cap_new, chnk_win_cap_old, "Juv winter"),
  capcompare(chnk_redd_cap_new, chnk_redd_cap_old, "Redds"))

chnk_summary %>%
  kable(booktabs = T,
        digits = c(0,0,1,0,0),
        align = "lcccc",
        format.args = list(big.mark = ","),
        col.names = c("Model", "Watershed", "Predicted capacity", "Capacity % change", "Predicted capacity SE", "SE % change" ),
        caption = "Estimated **chinook** capacities and comparison with previous  random forest extrapolations for eight watersheds") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed")) %>%
  collapse_rows(columns = 1:2)



```


#### Steelhead


```{r sthd-maps-comp, fig.cap = "Change in predicted habitat capacity for steelhead compared o the previous extrapolation, by life-stage, within the North Fork Salmon watershed.."}
ggarrange(sthd_sum_comp_map,
          sthd_win_comp_map,
          sthd_redd_comp_map)

```

```{r sthd-comp-summary-tbls}

sthd_summary = bind_rows(
  capcompare(sthd_sum_cap_new, sthd_sum_cap_old, "Juv summer"),
  capcompare(sthd_win_cap_new, sthd_win_cap_old, "Juv winter"),
  capcompare(sthd_redd_cap_new, sthd_redd_cap_old, "Redds"))

sthd_summary %>%
  kable(booktabs = T,
        digits = c(0,0,1,0,0),
        align = "lcccc",
        format.args = list(big.mark = ","),
        col.names = c("Model", "Watershed", "Predicted capacity" , "Capacity % change", "Predicted capacity SE", "SE % change" ),
        caption = "Estimated **winter steelhead** capacities and comparison with previous  random forest extrapolations for eight watersheds") %>%
    collapse_rows(columns = 1:2) %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))


```


### Capacity by stream

#### Chinook

```{r chnk-sum-tbl, eval = F}
chnk_sum_cap_new %>%
  subset(!StreamName == "Total" | is.na(StreamName)) %>%
  adorn_totals() %>%
  mutate(tot_length = tot_length / 1000) %>%
  rename(`n Reaches` = n_rchs,
         `Stream Length (km)` = tot_length,
         Capacity = tot_cap,
         `Capacity SE` = tot_cap_se) %>%
  kable(booktabs = T,
        digits = c(0,0,1,0,0),
        align = "lcccc",
        format.args = list(big.mark = ","),
        col.names = c("Stream Name","Reaches","Stream Length (km)", "Capacity","Capacity SE"),
        caption = "Estimated available habitat for **juvenile summer rearing** Chinook salmon in the eight salmon watershedss.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

```

```{r chnk-win-tbl, eval = F}
chnk_win_cap_new %>%
  subset(!StreamName == "Total" | is.na(StreamName)) %>%
  adorn_totals() %>%
  mutate(tot_length = tot_length / 1000) %>%
  rename(`n Reaches` = n_rchs,
         `Stream Length (km)` = tot_length,
         Capacity = tot_cap,
         `Capacity SE` = tot_cap_se) %>%
  kable(booktabs = T,
        digits = c(0,0,1,0,0),
        align = "lcccc",
        format.args = list(big.mark = ","),
        col.names = c("Stream Name","Reaches","Stream Length (km)", "Capacity","Capacity SE"),
        caption = "Estimated available habitat for **juvenile winter rearing** Chinook salmon in the eight salmon watersheds.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

```

```{r chnk-redd-tbl, eval = F}
chnk_redd_cap_new %>%
  subset(!StreamName == "Total" | is.na(StreamName)) %>%
  adorn_totals() %>%
  mutate(tot_length = tot_length / 1000) %>%
  rename(`n Reaches` = n_rchs,
         `Stream Length (km)` = tot_length,
         Capacity = tot_cap,
         `Capacity SE` = tot_cap_se) %>%
  kable(booktabs = T,
        digits = c(0,0,1,0,0),
        align = "lcccc",
        format.args = list(big.mark = ","),
        col.names = c("Stream Name","Reaches","Stream Length (km)", "Capacity","Capacity SE"),
        caption = "Estimated available **spawning (redds)** habitat for Chinook salmon in the eight salmon watersheds.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

```

#### Steelhead

```{r sthd-sum-tbl, eval = F}
sthd_sum_cap_new %>%
  subset(!StreamName == "Total" | is.na(StreamName)) %>%
  adorn_totals() %>%
  mutate(tot_length = tot_length / 1000) %>%
  rename(`n Reaches` = n_rchs,
         `Stream Length (km)` = tot_length,
         Capacity = tot_cap,
         `Capacity SE` = tot_cap_se) %>%
  kable(booktabs = T,
        digits = c(0,0,1,0,0),
        align = "lcccc",
        format.args = list(big.mark = ","),
        col.names = c("Stream Name","Reaches","Stream Length (km)", "Capacity","Capacity SE"),
        caption = "Estimated available habitat for **juvenile summer rearing** steelhead in the eight salmon watersheds.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

```

```{r sthd-win-tbl, eval = F}
sthd_win_cap_new %>%
  subset(!StreamName == "Total" | is.na(StreamName)) %>%
  adorn_totals() %>%
  mutate(tot_length = tot_length / 1000) %>%
  rename(`n Reaches` = n_rchs,
         `Stream Length (km)` = tot_length,
         Capacity = tot_cap,
         `Capacity SE` = tot_cap_se) %>%
  kable(booktabs = T,
        digits = c(0,0,1,0,0),
        align = "lcccc",
        format.args = list(big.mark = ","),
        col.names = c("Stream Name","Reaches","Stream Length (km)", "Capacity","Capacity SE"),
        caption = "Estimated available habitat for **juvenile winter rearing** steelhead in the eight salmon watersheds.") %>%
  kable_styling(full_width = F,
                position = "center",

                bootstrap_options = c("striped", "condensed"))

```

```{r sthd-redd-tbl, eval = F}
sthd_redd_cap_new %>%
  subset(!StreamName == "Total" | is.na(StreamName)) %>%
  adorn_totals() %>%
  mutate(tot_length = tot_length / 1000) %>%
  rename(`n Reaches` = n_rchs,
         `Stream Length (km)` = tot_length,
         Capacity = tot_cap,
         `Capacity SE` = tot_cap_se) %>%
  kable(booktabs = T,
        digits = c(0,0,1,0,0),
        align = "lcccc",
        format.args = list(big.mark = ","),
        col.names = c("Stream Name","Reaches","Stream Length (km)", "Capacity","Capacity SE"),
        caption = "Estimated available **spawning (redds)** habitat for steelhead in the eight salmon watersheds.") %>%
  kable_styling(full_width = F,
                position = "center",
                bootstrap_options = c("striped", "condensed"))

```
